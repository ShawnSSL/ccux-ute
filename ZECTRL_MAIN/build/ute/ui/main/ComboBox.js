sap.ui.define(["jquery.sap.global","sap/ui/core/Control","sap/ui/core/Popup","ute/ui/main/Checkbox","ute/ui/main/DropdownItem"],function(a,b,c){"use strict";var d=b.extend("ute.ui.main.ComboBox",{metadata:{library:"ute.ui.main",properties:{value:{type:"string",group:"Data",defaultValue:"",bindable:"bindable"},design:{type:"ute.ui.main.ComboBoxDesign",defaultValue:ute.ui.main.DropdownDesign.Default},enabled:{type:"boolean",defaultValue:!0},selectedKey:{type:"string",defaultValue:null},allowOnlyListed:{type:"boolean",defaultValue:!1}},aggregations:{content:{type:"ute.ui.main.ComboBoxItem",multiple:!0,singularName:"content"},_headerContent:{type:"ute.ui.main.ComboBoxItem",multiple:!1,visibility:"hidden"}},defaultAggregation:"content",events:{select:{parameters:{selectedKey:{type:"string"}}},change:{parameters:{newValue:{type:"string"}}}}}});return d.prototype.onBeforeRendering=function(){var a=this.getAggregation("_headerContent");this.getSelectedKey()&&this.setValue(a.getContent()[0].mProperties.text),console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!Rendered")},d.prototype._checkChange=function(a){var b,c=a.target.value,d=this.getValue(),e=this.getAggregation("content");if(c)c=c.trim();else for(b=0;b<e.length;b+=1)e[b].setShow(!0);d&&(d=d.trim()),this.getEnabled()&&d!==c&&(this.setProperty("value",c,!0),this.fireChange({newValue:c}))},d.prototype.onfocusout=function(a){this._checkChange(a),a.preventDefault(),a.stopPropagation&&a.stopPropagation()},d.prototype._handleArrowKey=function(a){var b,c=a.key,d=this.getAggregation("content");for(b=0;b<d.length;b+=1)if(d[b].$().hasClass("uteMDdItem-Focused")&&d[b].getShow())return d[b].$().removeClass("uteMDdItem-Focused"),void(("ArrowDown"===c||"Down"===a.key)&&b<d.length-1?d[b+1].$().addClass("uteMDdItem-Focused"):("ArrowUp"===c||"Up"===a.key)&&b>0&&d[b-1].$().addClass("uteMDdItem-Focused"));for(b=0;b<d.length;b+=1)if(d[b].getShow())return void d[b].$().addClass("uteMDdItem-Focused")},d.prototype._handleEnterKey=function(){var a,b=this.getAggregation("content");for(a=0;a<b.length;a+=1)if(b[a].$().hasClass("uteMDdItem-Focused"))return b[a].$().removeClass("uteMDdItem-Focused"),this.setSelectedKey(b[a].mBindingInfos.key.binding.oContext.oModel.oData.US_State[a].sAbvName),this.fireSelect({selectedKey:b[a].mBindingInfos.key.binding.oContext.oModel.oData.US_State[a].sAbvName}),void this.setProperty("value",b[a].mBindingInfos.key.binding.oContext.oModel.oData.US_State[a].sFullName,!0);this.setSelectedKey(""),this.fireSelect({selectedKey:""})},d.prototype.onkeyup=function(b){var d,e,f,g=b.target.value,h=this.getAggregation("content");for(("ArrowDown"===b.key||"ArrowUp"===b.key||"Down"===b.key||"Up"===b.key)&&this._handleArrowKey(b),"Enter"===b.key&&this._handleEnterKey(b),this.getEnabled()&&this._hasContent()&&(this.$().addClass("uteMDd-active"),this.$("picker").css("z-index",c.getNextZIndex()),a(document).on("click",a.proxy(this._autoClose,this))),f=!1,d=0;d<h.length;d+=1)e=h[d].mBindingInfos.key.binding.oContext.oModel.oData.US_State[d].sFullName,this._bStartWith(e,g)?(h[d].setShow(!0),f=!0):h[d].setShow(!1);if(this.getAllowOnlyListed()&&!f)for(g=g.slice(0,-1),this.setValue(g),b.target.value=g,d=0;d<h.length;d+=1)e=h[d].mBindingInfos.key.binding.oContext.oModel.oData.US_State[d].sFullName,h[d].setShow(this._bStartWith(e,g)?!0:!1)},d.prototype._bStartWith=function(a,b){return 0===a.toLowerCase().indexOf(b.toLowerCase())?!0:!1},d.prototype.onclick=function(b){b.stopPropagation(),this.$().hasClass("uteMDd-active")?(this.$().removeClass("uteMDd-active"),a(document).off("click",this._autoClose)):this.getEnabled()&&this._hasContent()&&(this.$().addClass("uteMDd-active"),this.$("picker").css("z-index",c.getNextZIndex()),a(document).on("click",a.proxy(this._autoClose,this)))},d.prototype._autoClose=function(){a(document).off("click",this._autoClose),this.$().removeClass("uteMDd-active")},d.prototype.setEnabled=function(a){return a=!!a,a?this.data("disabled",null):this.data("disabled","disabled",!0),this.setProperty("enabled",a),this},d.prototype.setSelectedKey=function(a){var b=this.getContent()||[];if("undefined"!=typeof a)return b.forEach(function(b){b.getKey()===a?b.data("selected","selected",!0):b.data("selected",null)}),this.setProperty("selectedKey",a),""!==a&&this._syncHeaderContent(),this},d.prototype.addContent=function(a){return a.attachPress(this._onDropdownItemPress,this),this.addAggregation("content",a),this},d.prototype.removeAllContent=function(){this.getAggregation("_headerContent")&&this.setAggregation("_headerContent",null),this.removeAllAggregation("content")},d.prototype.bindAggregation=function(){return this.getAggregation("_headerContent")&&this.setAggregation("_headerContent",null),b.prototype.bindAggregation.apply(this,arguments)},d.prototype.insertContent=function(a,b){return a.attachPress(this._onDropdownItemPress,this),this.insertAggregation("content",a,b),this},d.prototype._onDropdownItemPress=function(a){this.setSelectedKey(a.getSource().getKey()),this.fireSelect({selectedKey:a.getSource().getKey()})},d.prototype._hasContent=function(){var a=this.getContent()||[];return a.length>0},d.prototype._syncHeaderContent=function(){var a=this.getContent()||[];this.getAggregation("_headerContent")&&this.setAggregation("_headerContent",null),a.forEach(function(a){a.getKey()===this.getSelectedKey()&&this.setAggregation("_headerContent",a.clone())}.bind(this))},d},!0);