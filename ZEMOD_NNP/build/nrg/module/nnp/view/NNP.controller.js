sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","jquery.sap.global","sap/ui/model/json/JSONModel"],function(a){"use strict";var b=a.extend("nrg.module.nnp.view.NNP");return b.prototype.onInit=function(){},b.prototype.onBeforeRendering=function(){var a,b,c,d,e=this.getView().getModel("comp-dashboard"),f=new sap.ui.model.json.JSONModel,g=this,h=new sap.ui.model.json.JSONModel({emailExist:!0});return a="/EmailNNPs(PartnerID='"+this._sPartnerID+"',Email='"+this._sEmail+"',EmailConsum='"+this._sEmailConsum+"')",this._sPartnerID?(this._OwnerComponent=this.getView().getParent().getParent().getParent().getController().getOwnerComponent(),this.getView().setModel(f,"oEditEmailNNP"),this.getView().setModel(h,"oLocalModel"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oEditEmailValidate"),this._OwnerComponent.getCcuxApp().setOccupied(!0),c=this.getView().byId("idnrgDB-EmailBox"),d=this.getView().byId("idnrgDB-DelEmailBox"),c.setVisible(!0),d.setVisible(!1),b={success:function(a){a&&(this._beforeOpenEditAddrDialogue=!0,a.Script?(a.messages=g._convertScripts(a.Script),a.showmsg=!0):(a.messages="",a.showmsg=!1),f.setData(a),(void 0===f.getProperty("/Email")||""===f.getProperty("/Email")||null===f.getProperty("/Email"))&&this.getView().getModel("oLocalModel").setProperty("/emailExist",!1))}.bind(this),error:function(){g.getView().getParent().close(),ute.ui.main.Popup.Alert({title:"Email edit",message:"NNP Entity Service Error"})}.bind(this)},void(e&&e.read(a,b))):(ute.ui.main.Popup.Alert({title:"NNP",message:"Not able to update Email"}),void this.onPopupClose())},b.prototype._formatEmailMkt=function(a){return"y"===a||"Y"===a?!0:!1},b.prototype._formatEmailMktReverse=function(a){return"y"===a||"Y"===a?!1:!0},b.prototype._formatPositiveX=function(a){return"x"===a||"X"===a?!0:!1},b.prototype._formatNegativeX=function(a){return"x"===a||"X"===a?!1:!0},b.prototype._convertScripts=function(a){var b,c,d=[],e=[];if(a)for(e=a.split("~"),c=0;c<e.length;c+=1)b=e[c],void 0!==b&&d.push({message:b});return d},b.prototype._onValidateEmailAddress=function(){var a,b,c,d,e,f=this.getView().getModel("oEditEmailValidate"),g=this.getView().getModel("comp-dashboard"),h=this.getView().getModel("oEditEmailNNP"),i=this;return this._OwnerComponent.getCcuxApp().setOccupied(!0),h.refresh(!0),c=h.getProperty("/Email"),void 0===c||""===c||null===c?void ute.ui.main.Popup.Alert({title:"Email address validation",message:"Please enter an email address"}):(d=c.indexOf("@"),e=c.lastIndexOf("."),1>d||d+2>e||e+2>=c.length?(ute.ui.main.Popup.Alert({title:"Email address validation",message:"Please enter an email address"}),!1):(b="/EmailVerifys('"+c+"')",a={success:function(a){a&&f.setData(a),i._OwnerComponent.getCcuxApp().setOccupied(!1)}.bind(this),error:function(){ute.ui.main.Popup.Alert({title:"Email address validation",message:"Email Validate Service Error"}),i._OwnerComponent.getCcuxApp().setOccupied(!1)}.bind(this)},void(g&&g.read(b,a))))},b.prototype._invalidEmail=function(a){return a.indexOf(" ")>0||a.indexOf(",")>0?!0:!1},b.prototype._onEditEmailSave=function(){var a,b,c=this.getView().getModel("comp-dashboard"),d=this.getView().getModel("oEditEmailNNP").getProperty("/PartnerID"),e=this.getView().getModel("oEditEmailNNP").getProperty("/Email"),f=this.getView().getModel("oEditEmailNNP").getProperty("/EmailConsum"),g=this.getView().getModel("oEditEmailNNP"),h=!0,i=this,j=function(){i.getView().getParent().close(),i._OwnerComponent.getCcuxApp().setOccupied(!1)};return this._invalidEmail(e)?(this.getView().byId("idEditEmail_Save_Invalid").setVisible(!0),!1):(this._OwnerComponent.getCcuxApp().setOccupied(!0),h=e===this._sEmail?!1:!0,"000"===f?(a="/EmailNNPs(PartnerID='"+d+"',Email='"+e+"',EmailConsum='')",g.setProperty("/EmailConsum","")):a="/EmailNNPs(PartnerID='"+d+"',Email='"+e+"',EmailConsum='"+f+"')",b={merge:!1,success:function(){ute.ui.main.Popup.Alert(h?{title:"Email save ",message:g.getProperty("/LdapMessage"),callback:j}:{title:"Email save",message:"Marketing Preference Updated Successfully",callback:j})}.bind(this),error:function(){ute.ui.main.Popup.Alert({title:"Email save",message:"Update Failed",callback:j}),i._OwnerComponent.getCcuxApp().setOccupied(!1)}.bind(this)},"Y"!==g.getProperty("/Ecd")&&"Y"!==g.getProperty("/Mkt")&&"Y"!==g.getProperty("/Offer")&&"Y"!==g.getProperty("/Ee")||e?void(c&&(g.oData&&g.oData.hasOwnProperty("messages")&&delete g.oData.messages,g.oData&&g.oData.hasOwnProperty("showmsg")&&delete g.oData.showmsg,c.update(a,g.oData,b))):(this._OwnerComponent.getCcuxApp().setOccupied(!1),void ute.ui.main.Popup.Alert({title:"Email delete",message:"Cannot save without Email Address when preferences set to YES."})))},b.prototype._onEditEmailDelete=function(){var a,b,c=this.getView().getModel("comp-dashboard"),d=this.getView().getModel("oEditEmailNNP").getProperty("/PartnerID"),e=this.getView().getModel("oEditEmailNNP"),f=this;return this._OwnerComponent.getCcuxApp().setOccupied(!0),a="/EmailNNPs(PartnerID='"+d+"',Email='',EmailConsum='')",b={success:function(){f.getView().getParent().close(),f._OwnerComponent.getCcuxApp().setOccupied(!1)}.bind(this),error:function(){f._OwnerComponent.getCcuxApp().setOccupied(!1),f.getView().getParent().close(),ute.ui.main.Popup.Alert({title:"Email delete",message:"Update Failed"})}.bind(this)},"Y"===e.getProperty("/Ecd")||"Y"===e.getProperty("/Mkt")||"Y"===e.getProperty("/Offer")||"Y"===e.getProperty("/Ee")?(this._OwnerComponent.getCcuxApp().setOccupied(!1),void ute.ui.main.Popup.Alert({title:"Email delete",message:"Cannot delete email when preferences set to YES."})):void(c&&c.remove(a,b))},b.prototype._formatEmailAddressText=function(a){return""===a||void 0===a?"CLICK to ADD":a},b.prototype._onShowDelEmailBox=function(){var a,b,c=this.getView().byId("idnrgDB-EmailBox"),d=this.getView().byId("idnrgDB-DelEmailBox"),e=this.getView().getModel("oEditEmailNNP"),f=e.getProperty("/Email"),g=this.getView().getModel("oLocalModel");if(void 0===f||""===f||null===f){if(!g.getProperty("/emailExist"))return void ute.ui.main.Popup.Alert({title:"Email address validation",message:"No Email to delete"})}else if(a=f.indexOf("@"),b=f.lastIndexOf("."),1>a||a+2>b||b+2>=f.length)return ute.ui.main.Popup.Alert({title:"Email address validation",message:"Please enter an email address"}),!1;return"Y"===e.getProperty("/Ecd")||"Y"===e.getProperty("/Mkt")||"Y"===e.getProperty("/Offer")||"Y"===e.getProperty("/Ee")?(this._OwnerComponent.getCcuxApp().setOccupied(!1),void ute.ui.main.Popup.Alert({title:"Email delete",message:"Cannot delete email when preferences set to YES."})):(c.setVisible(!1),void d.setVisible(!0))},b.prototype._onEmailCancel=function(){var a,b,c=this.getView().byId("idnrgDB-EmailBox"),d=this.getView().byId("idnrgDB-DelEmailBox"),e=this.getView().getModel("comp-dashboard"),f=this._sPartnerID,g=this._sEmail,h=this._sEmailConsum,i=this,j=this.getView().getModel("oEditEmailNNP");this._OwnerComponent.getCcuxApp().setOccupied(!0),a="/EmailNNPs(PartnerID='"+f+"',Email='"+g+"',EmailConsum='"+h+"')",b={success:function(a){a&&(j.setData(a),(void 0===j.getProperty("/Email")||""===j.getProperty("/Email")||null===j.getProperty("/Email"))&&this.getView().getModel("oLocalModel").setProperty("/emailExist",!1),i._OwnerComponent.getCcuxApp().setOccupied(!1))}.bind(this),error:function(){ute.ui.main.Popup.Alert({title:"Email cancel",message:"NNP Entity Service Error"}),i._OwnerComponent.getCcuxApp().setOccupied(!1)}.bind(this)},e&&e.read(a,b),c.setVisible(!0),d.setVisible(!1)},b.prototype._onMktPrefTogg=function(a){var b=this.getView().getModel("oEditEmailNNP");a.mParameters.id.indexOf("ctaddr")>0?a.mParameters.selectedItem.sId.indexOf("left")>0?b.setProperty("/Ecd","Y"):b.setProperty("/Ecd","N"):a.mParameters.id.indexOf("rpdsrv")>0?a.mParameters.selectedItem.sId.indexOf("left")>0?b.setProperty("/Mkt","Y"):b.setProperty("/Mkt","N"):a.mParameters.id.indexOf("thrdpty")>0?a.mParameters.selectedItem.sId.indexOf("left")>0?b.setProperty("/Offer","Y"):b.setProperty("/Offer","N"):a.mParameters.selectedItem.sId.indexOf("left")>0?b.setProperty("/Ee","Y"):b.setProperty("/Ee","N")},b.prototype.onPopupClose=function(){this.getView().getParent().close()},b});