sap.ui.define(["nrg/base/view/BaseController","sap/ui/core/routing/HashChanger","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","nrg/module/dashboard/view/DepositToolPopup"],function(a,b,c,d,e,f){"use strict";var g=a.extend("nrg.module.dashboard.view.CustomerDataSummary");return g.prototype.onInit=function(){},g.prototype.onBeforeRendering=function(){this.getView().setModel(this.getOwnerComponent().getModel("comp-dashboard"),"oODataSvc"),this.getView().setModel(this.getOwnerComponent().getModel("comp-dashboard-AcctAccessPty"),"oDataASvc"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oSmryBpInf"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oSmryBuagInf"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oSmryAllBuags"),this.allCoBadges?(this.getView().setModel(new sap.ui.model.json.JSONModel,"oSmryCoBadges"),this.getView().getModel("oSmryCoBadges").setData(this.allCoBadges)):this.getView().setModel(new sap.ui.model.json.JSONModel,"oSmryCoBadges"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oSmryBpSegInf"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oSmryBpAllSegInf"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oSmryAssignedAccounts"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oSmryAccessAuth"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oSumm-Weather");var a=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo(),b=this.getOwnerComponent().getGlobalDataManager();b.getGDCProperty("/weather")&&this._UpdateWeather(b.getGDCProperty("/weather"),!1),this._bpNum=a.parameters.bpNum,this._caNum=a.parameters.caNum,this._coNum=a.parameters.coNum,this._initRetrBpInf(),this._checkThirdPartyAuth(this._caNum)},g.prototype.onAfterRendering=function(){var a=sap.ui.getCore().getEventBus();a.unsubscribe("nrg.module.dashoard","eBuagChanged",this._handleBuagChanged,this),a.subscribe("nrg.module.dashoard","eBuagChanged",this._handleBuagChanged,this),a.unsubscribe("nrg.module.dashoard","eBuagChangedFromCaInfo",this._handleCaInfoContractChanged,this),a.subscribe("nrg.module.dashoard","eBuagChangedFromCaInfo",this._handleCaInfoContractChanged,this),a.unsubscribe("nrg.module.dashoard","eCoChanged",this._handleCoChanged,this),a.subscribe("nrg.module.dashoard","eCoChanged",this._handleCoChanged,this),this.getOwnerComponent().getCcuxApp().updateFooter(this._bpNum,this._caNum,this._coNum)},g.prototype._handleBuagChanged=function(a,b,c){this._selectBuag(c.iIndex)},g.prototype._handleCaInfoContractChanged=function(a,b,c){var d,e=this.getView().getModel("oSmryAllBuags");for(d=0;d<e.getProperty("/results").length;d+=1)if(parseInt(e.getProperty("/results")[d].ContractAccountID,10)===parseInt(c.caNum,10))return void this._selectBuag(d)},g.prototype._handleCoChanged=function(a,b,c){var d=this.getView().getModel("oSmryCoBadges");d.setData(c.coInfo.COBadges),this.allCoBadges=c.coInfo.COBadges,this._UpdateWeather(c,!0)},g.prototype._UpdateWeather=function(a,b){var c=this.getView().getModel("oSumm-Weather"),d={},e=this.getOwnerComponent().getGlobalDataManager();a.coInfo&&a.coInfo.CurrTemp?c.setProperty("/temp",a.coInfo.CurrTemp+" F"):c.setProperty("/temp",""),a.coInfo&&a.coInfo.City1&&a.coInfo.Region?c.setProperty("/Address",a.coInfo.City1+", "+a.coInfo.Region):c.setProperty("/Address",""),a.coInfo.WthrIcon?c.setProperty("/Icon",this._onSelectIcon(a.coInfo.WthrIcon)):c.setProperty("/Icon",""),b&&(d.coInfo={},d.coInfo.CurrTemp=a.coInfo.CurrTemp,d.coInfo.City1=a.coInfo.City1,d.coInfo.Region=a.coInfo.Region,d.coInfo.WthrIcon=a.coInfo.WthrIcon,e.setGDCProperty("/weather",d))},g.prototype._onSelectIcon=function(a){var b="sap-icon://nrg-icon/weather-sunny";if(!a)return b;switch(a=a.replace(/^[0]+/g,"")){case"1d":b="sap-icon://nrg-icon/weather-sunny";break;case"1n":b="sap-icon://nrg-icon/weather-1n";break;case"2d":b="sap-icon://nrg-icon/weather-cloud";break;case"2n":b="sap-icon://nrg-icon/weather-2n";break;case"3d":b="sap-icon://nrg-icon/weather-3d";break;case"3n":b="sap-icon://nrg-icon/weather-3n";break;case"4d":b="sap-icon://nrg-icon/weather-4";break;case"4n":b="sap-icon://nrg-icon/weather-4";break;case"9d":b="sap-icon://nrg-icon/weather-rain";break;case"9n":b="sap-icon://nrg-icon/weather-rain";break;case"10d":b="sap-icon://nrg-icon/weather-rain-sun";break;case"10n":b="sap-icon://nrg-icon/weather-10n";break;case"11d":b="sap-icon://nrg-icon/weather-11";break;case"11n":b="sap-icon://nrg-icon/weather-11";break;case"13d":b="sap-icon://nrg-icon/weather-snow";break;case"13n":b="sap-icon://nrg-icon/weather-snow"}return b},g.prototype._initRetrBpInf=function(){{var a;this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo()}a="/Partners('"+this._bpNum+"')",this._retrBpInf(a),this._initRetrCaInf(this._bpNum),this._initRetrBpSegInf(this._bpNum)},g.prototype._initRetrBpSegInf=function(a){var b;b="/Partners('"+a+"')/BpSegs",this._retrBpSegInf(b)},g.prototype._initRetrCaInf=function(a){{var b;this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo()}b="/Partners('"+a+"')/Buags",this._retrCaInf(b)},g.prototype._initRetrAssignedAccount=function(a){var b;a&&(b="/Buags('"+a+"')/BpAssigns",this._retrAssignedAccount(b))},g.prototype._retrAssignedAccount=function(a){var b,c=this.getView().getModel("oODataSvc");b={success:function(a){a.results&&(0===a.results.length?this.getView().byId("id_AssignedAccBtn").setVisible(!1):(this.getView().byId("id_AssignedAccBtn").setVisible(!0),this.getView().getModel("oSmryAssignedAccounts").setData(a.results)))}.bind(this),error:function(){}.bind(this)},c&&c.read(a,b)},g.prototype._validateCA=function(){this.getView().getModel("oSmryBuagInf").getProperty("/IsSiebelCust")&&this._showSiebelAlert()},g.prototype._retrCaInf=function(a){var b,c,d=this.getView().getModel("oODataSvc");b={success:function(a){if(a){if(this._caNum)for(c=0;c<a.results.length;c+=1)parseInt(a.results[c].ContractAccountID,10)===parseInt(this._caNum,10)&&this.getView().getModel("oSmryBuagInf").setData(a.results[c]);else this.getView().getModel("oSmryBuagInf").setData(a.results[0]);this._validateCA(),this._initRetrAssignedAccount(this.getView().getModel("oSmryBuagInf").getProperty("/ContractAccountID")),this._caNum=this.getView().getModel("oSmryBuagInf").getProperty("/ContractAccountID")}}.bind(this),error:function(){}.bind(this)},d&&d.read(a,b)},g.prototype._selectBuag=function(a){this.getView().getModel("oSmryAllBuags").getProperty("/results").length>=a&&(this.getView().getModel("oSmryBuagInf").setData(this.getView().getModel("oSmryAllBuags").getProperty("/results")[a]),this._validateCA(),this.getView().getModel("oSmryAllBuags").setProperty("/selectedIndex",a),this.getView().getModel("oSmryBuagInf").getProperty("/ContractAccountID")&&(this._initRetrAssignedAccount(this.getView().getModel("oSmryBuagInf").getProperty("/ContractAccountID")),this._caNum=this.getView().getModel("oSmryBuagInf").getProperty("/ContractAccountID"),this._checkThirdPartyAuth(this._caNum)))},g.prototype._retrBpInf=function(a){var b,c,d=this.getView().getModel("oODataSvc");b={urlParameters:{$expand:"Buags"},success:function(a){if(a){this.getView().getModel("oSmryBpInf").setData(a);var b=0;if(this._caNum)for(c=0;c<a.Buags.results.length;c+=1)parseInt(a.Buags.results[c].ContractAccountID,10)===parseInt(this._caNum,10)&&(b=c);a.Buags.results[b]&&(this.getView().getModel("oSmryBuagInf").setData(a.Buags.results[b]),this.getView().getModel("oSmryAllBuags").setData(a.Buags),this.getView().getModel("oSmryAllBuags").setProperty("/selectedIndex",b))}}.bind(this),error:function(){}.bind(this)},d&&d.read(a,b)},g.prototype._retrBpSegInf=function(a){var b,c,d=this.getView().getModel("oODataSvc"),e={results:[]};b={success:function(a){if(a)if(a.results.length<=3){for(c=0;c<a.results.length;c+=1)a.results[c].moreThanThree=!1;this.getView().getModel("oSmryBpSegInf").setData(a.results)}else{for(c=0;3>c;c+=1)a.results[c].moreThanThree=2>c?!1:!0,e.results.push(a.results[c]);this.getView().getModel("oSmryBpSegInf").setData(e.results),this.getView().getModel("oSmryBpAllSegInf").setData(a.results)}}.bind(this),error:function(){}.bind(this)},d&&d.read(a,b)},g.prototype._onAssignedAccountClick=function(){this._oAssignedPopup=ute.ui.main.Popup.create({content:this.getView().byId("idAssignedAccs"),title:"ASSIGNED ACCOUNTS"}),this._oAssignedPopup.open()},g.prototype._onExpandSegInfoClick=function(){this._oSegPopup=ute.ui.main.Popup.create({content:this.getView().byId("idThreeSegs"),title:"SEGMENTATION"}),this._oSegPopup.open()},g.prototype._onBpNumClicked=function(){var a=this.getOwnerComponent().getRouter();this._caNum?this._coNum?a.navTo("bupa.bpInfo",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum}):a.navTo("bupa.bpInfoNoCo",{bpNum:this._bpNum,caNum:this._caNum}):a.navTo("bupa.bpInfoNoCoNoCa",{bpNum:this._bpNum})},g.prototype._onCaNumClicked=function(){var a=this.getOwnerComponent().getRouter();this._coNum?a.navTo("bupa.caInfo",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum}):a.navTo("bupa.caInfoNoCo",{bpNum:this._bpNum,caNum:this._caNum})},g.prototype._onDepositToolClicked=function(){this.DepositToolPopupCustomControl||(this.DepositToolPopupCustomControl=new f({title:"DEPOSIT TOOL"}),this.DepositToolPopupCustomControl.attachEvent("DepositToolCompleted",function(){},this),this.getView().addDependent(this.DepositToolPopupCustomControl)),this.DepositToolPopupCustomControl.preparePopup()},g.prototype._checkThirdPartyAuth=function(a){var b,c="/Buags('"+a+"')",d=this.getView().getModel("oODataSvc"),e=this.getView().getModel("oSmryAccessAuth"),f=!1;b={success:function(a){if("X"===a.ThirdPrtyAuth||"x"===a.ThirdPrtyAuth){this._retrThirdPartyAuth(this._caNum,function(){f=!0});var b=setInterval(function(){f&&(clearInterval(b),this._setHoverAuthNames(e))}.bind(this),100);this.getView().byId("idBtnAuth").setVisible(!0),this.getView().byId("idBpName").addStyleClass("nrgDashboard-cusDataSum-bpName-AcctAccessPty")}else this.getView().byId("idBtnAuth").setVisible(!1),this.getView().byId("idBpName").removeStyleClass("nrgDashboard-cusDataSum-bpName-AcctAccessPty")}.bind(this),error:function(){}.bind(this)},d&&d.read(c,b)},g.prototype._setHoverAuthNames=function(a){var b,c=[];if(a.oData.length){for(b=0;3>b;b+=1)a.oData[b]&&c.push({Name:a.oData[b].AuthPrtyName});a.setProperty("/hoverAuthNames",c)}},g.prototype._onAuthPtyClicked=function(){var a,b=this.getView().getModel("oSmryAccessAuth"),c=!1;this.getOwnerComponent().getCcuxApp().setOccupied(!0),this._retrThirdPartyAuth(this._caNum,function(){c=!0}),a=setInterval(function(){if(c){this.getOwnerComponent().getCcuxApp().setOccupied(!1),clearInterval(a),this._oAccAuthPtyPopup||(this._oAccAuthPtyPopup=ute.ui.main.Popup.create({content:sap.ui.xmlfragment(this.getView().sId,"nrg.module.dashboard.view.AcctAccessAuthPty",this),title:"ACCOUNT ACCESS AUTHORIZATION"}),this._oAccAuthPtyPopup.addStyleClass("nrgDashboard-accAuthPtyPopup"),this.getView().addDependent(this._oAccAuthPtyPopup));var d,e,f,g,h,i=this.getView().byId("nrgDashboard-AcctAccessAuthPty-tableBody");for(d=i.getContent().length,e=0;d>e;e+=1)i.removeContent(0);for(f=0;f<b.oData.length;f+=1)g=new ute.ui.commons.Tag({elem:"div"}).addStyleClass("nrgDashboard-AcctAccessAuthPty-tableRow"),(f+1)%2===0&&g.addStyleClass("nrgDashboard-AcctAccessAuthPty-tableRow-even"),g.addContent(new ute.ui.commons.Tag({elem:"div",text:b.oData[f].AuthPrtyName}).addStyleClass("nrgDashboard-AcctAccessAuthPty-tableRow-AuthParty")),g.addContent(new ute.ui.commons.Tag({elem:"div",text:b.oData[f].LegalDoc}).addStyleClass("nrgDashboard-AcctAccessAuthPty-tableRow-TypeLegalDoc")),g.addContent(new ute.ui.commons.Tag({elem:"div",text:b.oData[f].ReceiveDate}).addStyleClass("nrgDashboard-AcctAccessAuthPty-tableRow-ReceivedDate")),g.addContent(new ute.ui.commons.Tag({elem:"div",text:b.oData[f].EffDate}).addStyleClass("nrgDashboard-AcctAccessAuthPty-tableRow-EffecDate")),g.addContent(new ute.ui.commons.Tag({elem:"div",text:b.oData[f].EndDate}).addStyleClass("nrgDashboard-AcctAccessAuthPty-tableRow-EndDate")),h=new ute.ui.commons.Tag({elem:"div",text:b.oData[f].Status}).addStyleClass("nrgDashboard-AcctAccessAuthPty-tableRow-Status"),"ACTIVE"===b.oData[f].Status&&h.addStyleClass("active"),"INACTIVE"===b.oData[f].Status&&h.addStyleClass("inactive"),g.addContent(h),i.addContent(g);this._oAccAuthPtyPopup.open()}}.bind(this),100)},g.prototype._retrThirdPartyAuth=function(a,b){var c,d="/Buags('"+a+"')/ThirdPartyAuth",e=this.getView().getModel("oODataSvc"),f=this.getView().getModel("oSmryAccessAuth");c={success:function(a){var c;if(a.results)for(f.setData(a.results),this._setHoverAuthNames(f),c=0;c<f.oData.length;c+=1)f.oData[c].ReceiveDate=this._formatThirdPartyAuthTime(f.oData[c].ReceiveDate),f.oData[c].EffDate=this._formatThirdPartyAuthTime(f.oData[c].EffDate),f.oData[c].EndDate=this._formatThirdPartyAuthTime(f.oData[c].EndDate);b&&b()}.bind(this),error:function(){}.bind(this)},e&&e.read(d,c)},g.prototype._formatThirdPartyAuthTime=function(a){if(a){var b=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM/dd/yyyy"}),c=b.format(new Date(a.getTime()));return c}},g.prototype._onAddThirdPartyAuth=function(){var a=this.getOwnerComponent().getCcuxWebUiManager();a.notifyWebUi("openIndex",{LINK_ID:"Z_ACC_AUTH"})},g.prototype._formatBadge=function(a){return"x"===a||"X"===a?!0:!1},g.prototype._showSiebelAlert=function(){ute.ui.main.Popup.Alert({title:"Siebel Contracted Account",message:"This is a Siebel Contracted account. Connect the caller to the CI Account Management Team for all account inquiries during their business hours of 7:30 AM to 5:30 PM, Monday through Friday (except holidays). After Hours: For service outages and Other Service Order requests, follow the defined process. For all other call types provide the customer with the CI Account Management Teamâ€™s toll free number and ask the customer to call back during business hours."})},g});