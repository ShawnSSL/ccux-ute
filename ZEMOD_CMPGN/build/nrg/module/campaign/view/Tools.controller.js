sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","jquery.sap.global","nrg/base/type/Price","sap/ui/model/json/JSONModel"],function(a,b,c,d,e,f){"use strict";var g=a.extend("nrg.module.campaign.view.Tools");return g.prototype.onInit=function(){},g.prototype.onBeforeRendering=function(){var a,b,c,e,g,h,i,j=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo();a=new f({selected:0,history:!1,cancel:!1,ReqNumber:"",ReqName:"",NoPhone:!1}),this._i18NModel=this.getOwnerComponent().getModel("comp-i18n-campaign"),this.getView().setModel(a,"localModel"),g=this._i18NModel.getProperty("nrgHistorySet"),this._sContract=j.parameters.coNum,this._sBP=j.parameters.bpNum,this._sCA=j.parameters.caNum,h=["Contract","Type"],i=[this._sContract,"H"],c=this._createSearchFilterObject(h,i),g+="/$count",b={filters:c,success:function(a){a&&(d.sap.log.info("Odata Read Successfully:::"),parseInt(a,10)>0&&this.getView().getModel("localModel").setProperty("/history",!0))}.bind(this),error:function(a){d.sap.log.info("Odata Failed:::"+a)}.bind(this)},e=this.getOwnerComponent().getModel("comp-campaign"),e&&e.read(g,b),g=this._i18NModel.getProperty("nrgPendingSwapsSet"),g+="/$count",h=["Contract"],i=[this._sContract],c=this._createSearchFilterObject(h,i),b={filters:c,success:function(a){a&&(d.sap.log.info("Odata Read Successfully:::"),parseInt(a,10)>0&&this.getView().getModel("localModel").setProperty("/cancel",!0))}.bind(this),error:function(a){d.sap.log.info("Odata Failed:::"+a)}.bind(this)},e=this.getOwnerComponent().getModel("comp-campaign"),e&&e.read(g,b)},g.prototype._createSearchFilterObject=function(a,d){var e,f=[];if(void 0!==a)for(e=0;e<a.length;e+=1)f.push(new b(a[e],c.EQ,d[e],""));return f},g.prototype.onHistoryPress=function(){this.navTo("campaignhistory",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sContract})},g.prototype.onCancelPress=function(){var a,b,c,d,e,f,g,h,i=this.getOwnerComponent().getModel("comp-campaign"),j=this;this._aPendingSelPaths=[],this.getOwnerComponent().getCcuxApp().setOccupied(!0),e=["Contract"],f=[this._sContract],d=this._createSearchFilterObject(e,f),this._oDialogFragment||(this._oDialogFragment=sap.ui.xmlfragment("PendingSwaps","nrg.module.campaign.view.PendingSwaps",this)),void 0===this._oCancelDialog&&(this._oCancelDialog=new ute.ui.main.Popup.create({title:"Change Campaign - Cancel",content:this._oDialogFragment})),a=this._i18NModel.getProperty("nrgPendingSwapsSet"),c=sap.ui.core.Fragment.byId("PendingSwaps","idnrgCamPds-pendTable"),g=sap.ui.core.Fragment.byId("PendingSwaps","idnrgCamPds-pendRow"),h=function(){var a=c.getBinding("rows");j._oCancelDialog.open(),j.getOwnerComponent().getCcuxApp().setOccupied(!1),a&&a.detachDataReceived(h)},c.setModel(i,"comp-campaign"),this._oDialogFragment.setModel(this.getView().getModel("localModel"),"localModel"),b={model:"comp-campaign",path:a,filters:d,template:g,events:{dataReceived:h}},this._oCancelDialog.addStyleClass("nrgCamHis-dialog"),c.bindRows(b)},g.prototype.onUsageHistory=function(){var a,b,c,d,e,f,g,h,i=this.getOwnerComponent().getModel("comp-usage"),j=this;this.getOwnerComponent().getCcuxApp().setOccupied(!0),e=["Contract"],f=[this._sContract],d=this._createSearchFilterObject(e,f),this._oUsageFragment||(this._oUsageFragment=sap.ui.xmlfragment("QuickUsage","nrg.module.campaign.view.QuickUsage",this)),void 0===this._oUsageDialog&&(this._oUsageDialog=new ute.ui.main.Popup.create({title:"Quick Usage",content:this._oUsageFragment})),a="/QuickUsageS",c=sap.ui.core.Fragment.byId("QuickUsage","idnrgUsageTable"),g=sap.ui.core.Fragment.byId("QuickUsage","idnrgUsageTable-Row"),h=function(){var a=c.getBinding("rows");c.getRows()&&c.getRows().length>0?j._oUsageDialog.open():ute.ui.main.Popup.Alert({title:"Usage History",message:"No Usage History found"}),j.getOwnerComponent().getCcuxApp().setOccupied(!1),a&&a.detachDataReceived(h)},c.setModel(i,"comp-usage"),b={model:"comp-usage",path:a,filters:d,template:g,events:{dataReceived:h}},this._oUsageDialog.addStyleClass("nrgCamHis-dialog"),c.bindRows(b)},g.prototype.onPendingSwapsSelected=function(a){var b,c,d,e=this._oDialogFragment.getModel("localModel").getProperty("/selected");return b=a.getSource().getParent().getBindingContext("comp-campaign").getPath(),a.getSource().getChecked()&&1===this._aPendingSelPaths.length?(ute.ui.main.Popup.Alert({title:"Information",message:"Only One Pending Swap allowed"}),void a.getSource().setChecked(!1)):(c=this._aPendingSelPaths.indexOf(b),a.getSource().getChecked()?(e+=1,d=0>c&&this._aPendingSelPaths.push(b)):(e-=1,d=c>-1&&this._aPendingSelPaths.splice(c,1)),void this._oDialogFragment.getModel("localModel").setProperty("/selected",e))},g.prototype.onSelected=function(a){a.getSource().getChecked()&&this._oDialogFragment.getModel("localModel").setProperty("/ReqNumber","")},g.prototype.onUsageClose=function(){this._oUsageDialog.close()},g.prototype.ProceedwithCancel=function(){var a,b,c,e,f,g=this.getOwnerComponent().getModel("comp-campaign");return b=this._oDialogFragment.getModel("localModel"),c=b.getProperty("/ReqName"),e=b.getProperty("/ReqNumber"),f=b.getProperty("/NoPhone"),this._aPendingSelPaths&&this._aPendingSelPaths.length>0?c&&""!==c?f||e&&""!==e?(g.setRefreshAfterChange(!1),this._aPendingSelPaths.forEach(function(b){var f=g.getContext(b);a={method:"POST",urlParameters:{iDoc:f.getProperty("IdocNo"),ReqNumber:e,Type:f.getProperty("SwapType"),ReqName:c,Contract:f.getProperty("Contract"),Hist:f.getProperty("HistoryNo")},success:function(){d.sap.log.info("Odata Read Successfully:::")}.bind(this),error:function(){d.sap.log.info("Eligibility Error occured")}.bind(this)},g.callFunction("/DeleteCampaign",a)}),void this._oCancelDialog.close()):void sap.ui.commons.MessageBox.alert("Please enter Requestor's Number or Select No Phone"):void sap.ui.commons.MessageBox.alert("Please enter Requestor's Name"):void sap.ui.commons.MessageBox.alert("Select Pending Swap to cancel")},g.prototype.ContinueWithoutCancel=function(){this._oCancelDialog.close()},g});