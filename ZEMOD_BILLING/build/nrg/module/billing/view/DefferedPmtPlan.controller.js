sap.ui.define(["nrg/base/view/BaseController","jquery.sap.global","nrg/base/type/Price","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","nrg/module/billing/view/EligPopup","nrg/module/quickpay/view/QuickPayPopup"],function(a,b,c,d,e,f,g,h){"use strict";var i=a.extend("nrg.module.billing.view.DefferedPmtPlan");return i.prototype.onBeforeRendering=function(){var a=this.getOwnerComponent().getCcuxContextManager().getContext().oData;this._bpNum=a.bpNum,this._caNum=a.caNum,this._coNum=a.coNum,this._isExt=a.isExt,this.getOwnerComponent().getCcuxApp().setOccupied(!0),this.getView().setModel(this.getOwnerComponent().getModel("comp-dppext"),"oDataSvc"),this.getView().setModel(new d,"oDppScrnControl"),this.getView().setModel(new d,"oDppEligible"),this.getView().setModel(new sap.ui.model.json.JSONModel,"oEligibility"),this.getView().setModel(new d,"oDppDeniedReason"),this.getView().setModel(new d,"oDppReasons"),this.getView().setModel(new d,"oDppSetUps"),this.getView().setModel(new d,"oDppStepOnePost"),this.getView().setModel(new d,"oDppStepOneSelectedData"),this.getView().setModel(new d,"oDppConfs"),this.getView().setModel(new d,"oDppConfsChecked"),this.getView().setModel(new d,"oDppStepTwoPost"),this.getView().setModel(new d,"oDppStepTwoConfirmdData"),this.getView().setModel(new d({GrantCL:"",DeniedCL:"",prepay:!1,showDownPay:!1,showFirstInstal:!1}),"oLocalModel"),this.getView().setModel(new sap.ui.model.json.JSONModel({current:!1,newAdd:!1,co:"",HouseNo:"",UnitNo:"",City:"",State:"",Country:"",AddrLine:"",Street:"",PoBox:"",ZipCode:"",NewAddrCheck:!1,NewAddressflag:!1,editable:!1}),"olocalAddress"),this.getView().setModel(new d,"oDppStepThreeCom"),this.getView().setModel(new d,"oDppDisplay"),this._setInitScreen(),this._retrieveNotification(),this._checkPrePay()},i.prototype.onAfterRendering=function(){this.getView().byId("nrgBilling-dpp-DppDueDate-id").attachBrowserEvent("select",this._handleDppFirstDueDateChange,this),this.getView().byId("nrgBilling-dpp-DppFirstInstlDate-id").attachBrowserEvent("select",this._handleDppFirstInstlChange,this)},i.prototype._checkPrePay=function(){var a,b=this.getOwnerComponent().getModel("comp-feeAdjs"),c="/PrepayFlagS('"+this._caNum+"')",d=this.getView().getModel("oLocalModel");a={success:function(a){a&&a.Prepay&&d.setProperty("/prepay",!0)}.bind(this),error:function(){}.bind(this)},b&&this._caNum&&b.read(c,a)},i.prototype._initScrnControl=function(){var a=this.getView().getModel("oDppScrnControl");return a.setProperty("/StepOne",!1),a.setProperty("/StepTwo",!1),a.setProperty("/StepThree",!1),a.setProperty("/DPPDenied",!1),a.setProperty("/Display",!1),a},i.prototype._selectScrn=function(a){if(this._initScrnControl().setProperty("/"+a,!0),"StepOne"===a)this._retrDppSetUp(),this._retrDppReason();else if("StepTwo"===a)this._retrDPPConf(),this._retrDisclosureMessage();else if("StepThree"===a)this._retrDppComunication();else if("DPPDenied"===a)this._retrDppDeniedReason();else{if("Display"!==a)return;this._retrExistingDpp()}},i.prototype._setInitScreen=function(){var a=this.getView().getModel("oDataSvc"),b="/DPPElgbles('"+this._coNum+"')",c=this,d={success:function(a){a&&(c.getView().getModel("oDppEligible").setData(a),c._selectScrn(a.Active?"Display":a.Eligible?"StepOne":"DPPDenied"))}.bind(this),error:function(){this.getOwnerComponent().getCcuxApp().setOccupied(!1)}.bind(this)};a&&this._coNum&&a.read(b,d)},i.prototype._isOdd=function(a){return a%2===0?!1:!0},i.prototype._isEven=function(a){return a%2===0?!0:!1},i.prototype._isOddDispConf=function(a,b){return"Yes"===b?!1:a%2===0?!1:!0},i.prototype._isEvenDispConf=function(a,b){return"Yes"===b?!1:a%2===0?!0:!1},i.prototype._isOddDispPaid=function(a,b){return"Yes"===b?a%2===0?!1:!0:!1},i.prototype._isEvenDispPaid=function(a,b){return"Yes"===b&&a%2===0?!0:!1},i.prototype._createSearchFilterObject=function(a,b,c){var d,g=[];if(c||(c=f.EQ),void 0!==a)for(d=0;d<a.length;d+=1)g.push(new e(a[d],f.EQ,b[d],""));return g},i.prototype._onDppDeniedOkClick=function(){var a=this.getOwnerComponent().getModel("comp-dppext"),b=this,c=(this.getView().byId("idnrgBilling-DPPDenCL"),this.getView().getModel("oLocalModel"));a.create("/DPPDenieds",{Contract:this._coNum,CA:this._caNum,BP:this._bpNum,Message:c.getProperty("/DeniedCL")||""},{success:function(a){a&&(ute.ui.main.Popup.Alert({title:"DPP",message:a.Message}),b.navTo("billing.CheckBook",{bpNum:b._bpNum,caNum:b._caNum,coNum:b._coNum}))},error:function(){}})},i.prototype._onDppOverrideClick=function(){var a=this.getView().getModel("oLocalModel"),b=a.getProperty("/prepay"),c=this.getOwnerComponent().getCcuxWebUiManager();b?c.notifyWebUi("openIndex",{LINK_ID:"Z_DPP_CR"}):this._selectScrn("StepOne")},i.prototype._onDPPThirdStepSend=function(){this._postDPPCommunication()},i.prototype._onReasonSelect=function(a){var b,c=this.getView().getModel("oDppReasons");for(b=0;b<c.oData.length;b+=1)c.oData[b].ReasonCode===a.mParameters.selectedKey&&c.setProperty("/selectedReason",c.oData[b].Reason)},i.prototype._onSelectAllCheck=function(a){var b,c=this.getView().getModel("oDppSetUps");if(a.mParameters.checked)for(b=0;b<c.getData().results.length;b+=1)c.getProperty("/results/"+b+"/OpenItems/DisplayOnlyRow")||c.setProperty("/results/"+b+"/OpenItems/bSelected",!0);else for(b=0;b<c.getData().results.length;b+=1)c.setProperty("/results/"+b+"/OpenItems/bSelected",!1)},i.prototype._onDppConfAllCheck=function(a){var b,c=this.getView().getModel("oDppConfs");if(a.mParameters.checked)for(b=0;b<c.getData().results.length;b+=1)c.setProperty("/results/"+b+"/Checked",!0);else for(b=0;b<c.getData().results.length;b+=1)c.setProperty("/results/"+b+"/Checked",!1);this._onStepTwoInstlChange(a)},i.prototype._onStepTwoInstlChange=function(){var a,b,c=this.getView().getModel("oDppConfs"),d=c.getProperty("/results/0/TotOutStd"),e=0;for(a=0;a<c.getData().results.length;a+=1)b=c.getProperty("/results/"+a+"/ConfirmdItems/Amount"),!isNaN(parseFloat(b))&&isFinite(b)&&parseFloat(b)||c.setProperty("/results/"+a+"/ConfirmdItems/Amount","0.00");for(a=0;a<c.getData().results.length;a+=1)e=(parseFloat(e)||0)+parseFloat(c.getProperty("/results/"+a+"/ConfirmdItems/Amount"));c.setProperty("/results/0/SelTot",e.toString()),c.setProperty("/results/0/DiffTot",(parseFloat(e)-parseFloat(d)).toFixed(2).toString())},i.prototype._onDistributeDiffClick=function(){var a,b,c,d,e=this.getView().getModel("oDppConfs"),f=0,g=0,h=0,i=e.getProperty("/results/0/TotOutStd"),j=0,k=!1,l=1,m=0;for(i&&(i=parseFloat(i)),a=0;a<e.getData().results.length;a+=1){if(d=e.getProperty("/results/"+a+"/ConfirmdItems/Amount"),isNaN(parseFloat(d))||!isFinite(d)||!parseFloat(d)){for(a=0;a<e.getData().results.length;a+=1)e.setProperty("/results/"+a+"/Checked",!1);return e.setProperty("/AllChecked",!1),void ute.ui.main.Popup.Alert({title:"DPP",message:"Installment amount must be number and greater than 0."})}if(parseFloat(d)<0){for(a=0;a<e.getData().results.length;a+=1)e.setProperty("/results/"+a+"/Checked",!1);return e.setProperty("/AllChecked",!1),void ute.ui.main.Popup.Alert({title:"DPP",message:"Installment amount must be number and greater than 0."})}}for(a=0;a<e.getData().results.length;a+=1)e.getProperty("/results/"+a+"/Checked")?(j=parseFloat(f)+parseFloat(e.getProperty("/results/"+a+"/ConfirmdItems/Amount")),g+=1):(f=parseFloat(f)+parseFloat(e.getProperty("/results/"+a+"/ConfirmdItems/Amount")),h+=1);for(g&&(b=(parseFloat(i)-parseFloat(f))/g,b&&(b=parseFloat(b).toFixed(2))),c=(parseFloat(f)+parseFloat(b)*g).toFixed(2),parseFloat(c)!==parseFloat(i)&&(k=!0,m=(parseFloat(i)-parseFloat(c)).toFixed(2)),a=0;a<e.getData().results.length;a+=1)e.getProperty("/results/"+a+"/Checked")&&(k?(l===g?e.setProperty("/results/"+a+"/ConfirmdItems/Amount",(parseFloat(b)+parseFloat(m)).toFixed(2)):e.setProperty("/results/"+a+"/ConfirmdItems/Amount",parseFloat(b).toFixed(2)),l+=1):e.setProperty("/results/"+a+"/ConfirmdItems/Amount",parseFloat(b).toFixed(2)));for(e.setProperty("/results/0/SelTot",i.toString()),e.setProperty("/results/0/DiffTot","0.00"),a=0;a<e.getData().results.length;a+=1)e.setProperty("/results/"+a+"/Checked",!1);e.setProperty("/AllChecked",!1)},i.prototype._formatPadZero=function(a,b){for(;a.length<b;)a="0"+a;return a},i.prototype._onDppConfConfirmClick=function(){var a,b,c,d="<div style='margin:10px; max-height: 200rem; overflow-y:auto'>"+this.sDisCloseMessage+"</div>",e=new sap.ui.core.HTML({content:d}),f=this,g=new ute.ui.main.Button({text:"OK",press:function(){a.close(),f._postDPPConfRequest()}}),h=new ute.ui.main.Button({text:"CANCEL",press:function(){a.close()}}),i=new ute.ui.commons.Tag,j=this.getView().getModel("oDppConfs"),k=(this.getView().getModel("oDppStepOnePost"),j.getProperty("/results/0/DiffTot")),l=0,m=!1,n=this.getView().byId("nrgBilling-dpp-DppFirstInstlDate-id").getValue(),o=new Date,p=this.getView().getModel("oLocalModel"),q=!1;if(isNaN(parseFloat(k))||!isFinite(k)||0!==parseFloat(k))return void ute.ui.main.Popup.Alert({title:"DPP",message:"Difference is not 0."});if(o&&(o.setHours("00"),o.setMinutes("00"),o.setSeconds("00")),m=p.getProperty("/showDownPay")||!1,b=this.getView().byId("nrgBilling-dpp-DppDueDate-id").getValue(),b&&(b=new Date(b)),m){if(!b)return void ute.ui.main.Popup.Alert({title:"DPP",message:"Please enter Down Payment Due Date."});b&&(b.setHours("00"),b.setMinutes("00"),b.setSeconds("00"))}if(q=p.getProperty("/showFirstInstal")||!1){if(!n)return void ute.ui.main.Popup.Alert({title:"DPP",message:"Please enter First Instalment Date."});if(n=new Date(n),n&&(n.setHours("00"),n.setMinutes("00"),n.setSeconds("00")),b&&n&&b.getTime()>n.getTime())return this.getOwnerComponent().getCcuxApp().setOccupied(!1),void ute.ui.main.Popup.Alert({title:"DPP",message:"Installment 2 must occur after "+this.getView().byId("nrgBilling-dpp-DppDueDate-id").getValue()})}for(l=0;l<j.getData().results.length;l+=1){if(c=j.getProperty("/results/"+l+"/ConfirmdItems/Amount"),isNaN(parseFloat(c))||!isFinite(c)||!parseFloat(c))return void ute.ui.main.Popup.Alert({title:"DPP",message:"Installment amount must be greater 0."});if(parseFloat(c)<0)return void ute.ui.main.Popup.Alert({title:"DPP",message:"Installment amount must be number and greater than 0."})}g.addStyleClass("nrgBillingDiscButton"),h.addStyleClass("nrgBillingDiscButton"),i.addContent(e),i.addContent(g),i.addContent(h),a=new ute.ui.main.Popup.create({title:"DISCLOSURE",content:i}),a.open()},i.prototype._onMain=function(){this._coNum?this.navTo("dashboard.VerificationWithCaCo",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum}):this.navTo("dashboard.VerificationWithCa",{bpNum:this._bpNum,caNum:this._caNum})},i.prototype._onCheckbook=function(){this._coNum?this.navTo("billing.CheckBook",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum}):this.navTo("billing.CheckBookNoCo",{bpNum:this._bpNum,caNum:this._caNum})},i.prototype._onDppCorresCancelClick=function(){var a=new h,b=this;this.getView().addDependent(a),a.openQuickPay(b._coNum,b._bpNum,b._caNum),a.attachEvent("PaymentCompleted",function(){b._onCheckbook()},this)},i.prototype._onDppConfCancelClick=function(){this._coNum?this.navTo("billing.CheckBook",{bpNum:this._bpNum,caNum:this._caNum,coNum:this._coNum}):this.navTo("billing.CheckBookNoCo",{bpNum:this._bpNum,caNum:this._caNum})},i.prototype._onOneItemCheck=function(a){a.mParameters.checked||this.getView().getModel("oDppSetUps").setProperty("/results/bSelectedAll",!1)},i.prototype._onDppSetUpOk=function(){var a,b=this.getView().getModel("oDppSetUps"),c=this.getView().getModel("oDppStepOnePost"),d=[],e=this.getView().getModel("oDppReasons"),f=c.getProperty("/InstlmntNo");if(!(!isNaN(parseFloat(f))&&isFinite(f)&&parseInt(f,10)>0))return void ute.ui.main.Popup.Alert({title:"DPP",message:"Please enter number of Installments"});if(e.getProperty("/selectedReason")){for(a=0;a<b.getData().results.length;a+=1)b.getProperty("/results/"+a+"/OpenItems/bSelected")&&d.push({IND:b.getProperty("/results/"+a+"/OpenItems/ItemNumber")});d&&d.length>0?(c.setProperty("/SelectedIndices",d),this.getView().getModel("oDppStepOneSelectedData").setProperty("/SELECTEDDATA",c.getProperty("/SelectedIndices")),this._selectScrn("StepTwo")):ute.ui.main.Popup.Alert({title:"DPP",message:"Please select at least one open item"})}else ute.ui.main.Popup.Alert({title:"DPP Open Items",message:"Please Select DPP Setup Reason"})},i.prototype._handleDppFirstDueDateChange=function(){var a=new Date(this.getView().byId("nrgBilling-dpp-DppDueDate-id").getValue()),b=this.getView().getModel("oDppConfs").oData,c=0;for(c=0;c<b.results.length;c+=1)b.results[c].ConfirmdItems.IsDownPay&&this.getView().getModel("oDppConfs").setProperty("/results/"+c+"/ConfirmdItems/DueDate",a)},i.prototype._handleDppFirstInstlChange=function(){var a=new Date(this.getView().byId("nrgBilling-dpp-DppFirstInstlDate-id").getValue()),b=this.getView().getModel("oDppConfs").oData,c=0;for(c=0;c<b.results.length;c+=1)b.results[c].ConfirmdItems.Is1stInstall&&this.getView().getModel("oDppConfs").setProperty("/results/"+c+"/ConfirmdItems/DueDate",a)},i.prototype._retrDPPConf=function(){var a,b,c,d,e,f,g,h=this.getView().getModel("oDataSvc");e=["BP","CA","Contract","SelectedData","InstlmntNo","ZeroDwnPay"],d=[this._bpNum,this._caNum,this._coNum,this.getView().getModel("oDppStepOneSelectedData").getJSON(),this.getView().getModel("oDppStepOnePost").getProperty("/InstlmntNo"),this.getView().getModel("oDppStepOnePost").getProperty("/ZeroDwnPay")],c=this._createSearchFilterObject(e,d),b="/DPPConfs",a={filters:c,success:function(a){var b;if(a){for(this.getView().getModel("oDppConfs").setData(a),f=0;f<a.results.length;f+=1)this.getView().getModel("oDppConfs").setProperty("/results/"+f+"/Checked",!1),this.getView().getModel("oDppConfs").setProperty("/results/"+f+"/ConfirmdItems/Amount",parseFloat(this.getView().getModel("oDppConfs").getProperty("/results/"+f+"/ConfirmdItems/Amount")));for(this.getView().getModel("oDppConfs").getProperty("/results/0/DPPError")&&ute.ui.main.Popup.Alert({title:"DPP",message:this.getView().getModel("oDppConfs").getProperty("/results/0/Message")}),this.getView().getModel("oDppConfs").setProperty("/results/AllChecked",!1),this.getView().getModel("oDppConfs").setProperty("/results/0/SelTot",0),this._onStepTwoInstlChange(),f=0;f<a.results.length;f+=1)a.results[f].ConfirmdItems.IsDownPay&&a.results[f].ConfirmdItems.DueDate&&(b=a.results[f].ConfirmdItems.DueDate,g=this._formatInvoiceDate(b.getDate(),b.getMonth()+1,b.getFullYear()),this.getView().getModel("oLocalModel").setProperty("/showDownPay",!0),this.getView().byId("nrgBilling-dpp-DppDueDate-id").setDefaultDate(g)),a.results[f].ConfirmdItems.Is1stInstall&&a.results[f].ConfirmdItems.DueDate&&(b=a.results[f].ConfirmdItems.DueDate,g=this._formatInvoiceDate(b.getDate(),b.getMonth()+1,b.getFullYear()),this.getView().getModel("oLocalModel").setProperty("/showFirstInstal",!0),this.getView().byId("nrgBilling-dpp-DppFirstInstlDate-id").setDefaultDate(g));this.getView().getModel("oDppSetUps").getProperty("/results/0/InstlmntNoAuth")||(this.getView().getModel("oLocalModel").setProperty("/showDownPay",!1),this.getView().getModel("oLocalModel").setProperty("/showFirstInstal",!1))}}.bind(this),error:function(){}.bind(this)},h&&h.read(b,a)},i.prototype._formatInvoiceDate=function(a,b,c){return 10>a&&(a="0"+a),10>b&&(b="0"+b),b+"/"+a+"/"+c},i.prototype._retrDisclosureMessage=function(){var a,b,c=this.getView().getModel("oDataSvc");b="/DPPDisclos",a={success:function(a){a&&(this.sDisCloseMessage=a.results[0].Text)}.bind(this),error:function(){}.bind(this)},c&&c.read(b,a)},i.prototype._postDPPConfRequest=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m=this.getView().getModel("oDataSvc"),n=this.getView().getModel("oDppStepTwoPost"),o=this,p=this.getView().getModel("oDppConfs"),q="",r="",s=(this.getView().byId("idnrgBilling-DPPAccCL"),this.getView().byId("nrgBilling-dpp-DppDueDate-id").getValue()),t=this.getView().getModel("oLocalModel"),u=this.getView().byId("nrgBilling-dpp-DppFirstInstlDate-id").getValue();for(a="/DPPConfs",n.setProperty("/CA",this._caNum),n.setProperty("/BP",this._bpNum),n.setProperty("/Contract",this._coNum),n.setProperty("/SelectedData",p.oData.results[0].SelectedData.replace(/"/g,"'")),n.setProperty("/InstlmntNo",p.oData.results[0].InstlmntNo),n.setProperty("/ZeroDwnPay",p.oData.results[0].ZeroDwnPay),u?n.setProperty("/InitialDate",new Date(u)):n.setProperty("/InitialDate",null),s?n.setProperty("/DwnPayDate",new Date(s)):n.setProperty("/DwnPayDate",null),n.setProperty("/DwnPay","'"+parseFloat(p.getProperty("/results/0/ConfirmdItems/Amount"))+"'"),n.setProperty("/ReasonCode",this.getView().getModel("oDppReasons").getProperty("/selectedKey")),n.setProperty("/Message",t.getProperty("/GrantCL")||""),c=0;c<p.getData().results.length;c+=1)d=p.getData().results[c].ConfirmdItems.Amount?parseFloat(p.getData().results[c].ConfirmdItems.Amount).toString():"0.00",e=p.getData().results[c].ConfirmdItems.DueDate?p.getData().results[c].ConfirmdItems.DueDate.getFullYear().toString()+this._formatPadZero((p.getData().results[c].ConfirmdItems.DueDate.getMonth()+1).toString(),2)+this._formatPadZero(p.getData().results[c].ConfirmdItems.DueDate.getDate().toString(),2):"null",f=p.getData().results[c].ConfirmdItems.ClearDate?p.getData().results[c].ConfirmdItems.ClearDate.getFullYear().toString()+this._formatPadZero((p.getData().results[c].ConfirmdItems.ClearDate.getMonth()+1).toString(),2)+this._formatPadZero(p.getData().results[c].ConfirmdItems.ClearDate.getDate().toString(),2):"null",g=p.getData().results[c].ConfirmdItems.Cleared?p.getData().results[c].ConfirmdItems.Cleared:"null",h=p.getData().results[c].ConfirmdItems.ClearedAmt?parseFloat(p.getData().results[c].ConfirmdItems.ClearedAmt).toString():"0.00",i=p.getData().results[c].ConfirmdItems.Opbel?p.getData().results[c].ConfirmdItems.Opbel:"null",j=p.getData().results[c].ConfirmdItems.Opupw?parseInt(p.getData().results[c].ConfirmdItems.Opupw,10).toString():"0",k=p.getData().results[c].ConfirmdItems.Opupk?parseInt(p.getData().results[c].ConfirmdItems.Opupk,10).toString():"0",l=p.getData().results[c].ConfirmdItems.Opupz?parseInt(p.getData().results[c].ConfirmdItems.Opupz,10).toString():"0",c===p.getData().results.length-1?(q+=p.getData().results[c].ConfirmdItems.ItemNumber.toString(),r+=d):(q=q+p.getData().results[c].ConfirmdItems.ItemNumber.toString()+",",r=r+d+",");n.setProperty("/CItemNum",q),n.setProperty("/CAmt",r),b={merge:!1,success:function(a){o.getOwnerComponent().getCcuxApp().setOccupied(!1);var b,c="<div style='margin:10px; max-height: 200rem; overflow-y:auto'>"+a.Message+"</div>",d=new sap.ui.core.HTML({content:c}),e=new ute.ui.main.Button({text:"OK",press:function(){b.close()}}),f=new ute.ui.commons.Tag;e.addStyleClass("nrgBillingDiscButton"),f.addContent(d),f.addContent(e),b=new ute.ui.main.Popup.create({title:"DPP",content:f}),b.open(),a.DPPError||o._selectScrn("StepThree")}.bind(this),error:function(){o.getOwnerComponent().getCcuxApp().setOccupied(!1),ute.ui.main.Popup.Alert({title:"DPP",message:"DEFERRED PAYMENT PLAN REQUEST FAILED"})}.bind(this)},m&&(this.getOwnerComponent().getCcuxApp().setOccupied(!0),m.create(a,n.oData,b))},i.prototype._retrDppDeniedReason=function(){var a,b,c,d,e,f,g=this.getView().getModel("oDataSvc");f=["Contract","BP","CA"],e=[this._coNum,this._bpNum,this._caNum],d=this._createSearchFilterObject(f,e),b="/DPPDenieds",a={filters:d,success:function(a){if(this.getOwnerComponent().getCcuxApp().setOccupied(!1),a){for(c=0;c<a.results.length;c+=1)a.results[c].DPPDenyed.iIndex=c+1;this.getView().getModel("oDppDeniedReason").setData(a)}}.bind(this),error:function(){this.getOwnerComponent().getCcuxApp().setOccupied(!1)}.bind(this)},g&&g.read(b,a)},i.prototype._retrDppReason=function(){var a,b,c=this.getView().getModel("oDataSvc");b="/DPPReasons",a={success:function(a){a&&(a.results.push({ReasonCode:"0000",Reason:""}),this.getView().getModel("oDppReasons").setData(a.results),this.getView().getModel("oDppEligible").getProperty("/DPPReasonYes")?(this.getView().getModel("oDppReasons").setProperty("/selectedKey","0000"),this.getView().getModel("oDppReasons").setProperty("/selectedReason",this.getView().getModel("oDppEligible").getProperty("/DPPReason"))):(this.getView().getModel("oDppReasons").setProperty("/selectedKey","0000"),this.getView().getModel("oDppReasons").setProperty("/selectedReason","")))}.bind(this),error:function(){}.bind(this)},c&&c.read(b,a)},i.prototype._retrDppSetUp=function(){var a,b,c,d,e,f,g=this.getView().getModel("oDataSvc");this.getView().getModel("oDppStepOnePost").setData({}),f=["Contract","CA"],e=[this._coNum,this._caNum],d=this._createSearchFilterObject(f,e),b="/DPPSetUps",a={filters:d,success:function(a){if(this.getOwnerComponent().getCcuxApp().setOccupied(!1),a){for(c=0;c<a.results.length;c+=1)a.results[c].bSelected=!1;this.getView().getModel("oDppSetUps").setData(a),this.getView().getModel("oDppSetUps").setProperty("/results/bSelectedAll",!1),this.getView().getModel("oDppStepOnePost").setProperty("/InstlmntNo",this.getView().getModel("oDppSetUps").getProperty("/results/0/InstlmntNo")),this.getView().getModel("oDppStepOnePost").setProperty("/ZeroDwnPay",!1)}}.bind(this),error:function(){this.getOwnerComponent().getCcuxApp().setOccupied(!1)}.bind(this)},g&&g.read(b,a)},i.prototype._retrExistingDpp=function(){var a,b,c=this.getView().getModel("oDataSvc");this.getView().getModel("oDppDisplay").setData({}),b="/DppDisplayS(BP='"+this._bpNum+"',CA='"+this._caNum+"')",a={urlParameters:{$expand:"Items"},success:function(a){this.getOwnerComponent().getCcuxApp().setOccupied(!1),a&&this.getView().getModel("oDppDisplay").setData(a)}.bind(this),error:function(){this.getOwnerComponent().getCcuxApp().setOccupied(!1)}.bind(this)},c&&c.read(b,a)},i.prototype._retrieveNotification=function(){var a,b,c,d,e="/EligCheckS('"+this._coNum+"')",f=this.getOwnerComponent().getModel("comp-eligibility"),g=this.getView().getModel("oEligibility"),h=this.getOwnerComponent().getModel("comp-i18n-billing");a={success:function(a){g.setData(a);var e=this.getView().byId("idnrgBilling-dpp-notifications");for(e&&e.getContent()&&e.getContent().length>0&&e.removeAllContent(),this._eligibilityAlerts=[],a.ABPElig?(("Y"===a.ABPElig||"y"===a.ABPElig)&&(d=h.getProperty("nrgNotfABPT")),("N"===a.ABPElig||"n"===a.ABPElig)&&(d=h.getProperty("nrgNotfABPF")),b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:d,linkPress:this._openEligABPPopup.bind(this)})):b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:h.getProperty("nrgNotfABPEmpty"),linkPress:this._reloadNotification.bind(this)}),this._eligibilityAlerts.push(b),a.EXTNElig?(("Y"===a.EXTNElig||"y"===a.ABPElig)&&(d=h.getProperty("nrgNotfEXTT")),("N"===a.EXTNElig||"n"===a.ABPElig)&&(d=h.getProperty("nrgNotfEXTF")),b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:d,linkPress:this._openEligABPPopup.bind(this)})):b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:h.getProperty("nrgNotfEXTEmpty"),linkPress:this._reloadNotification.bind(this)}),this._eligibilityAlerts.push(b),a.RBBElig?(("Y"===a.RBBElig||"y"===a.ABPElig)&&(d=h.getProperty("nrgNotfRBPT")),("N"===a.RBBElig||"n"===a.ABPElig)&&(d=h.getProperty("nrgNotfRBPF")),b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:d,linkPress:this._openEligABPPopup.bind(this)})):b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:h.getProperty("nrgNotfRBPEmpty"),linkPress:this._reloadNotification.bind(this)}),this._eligibilityAlerts.push(b),a.DPPElig?(("Y"===a.DPPElig||"y"===a.ABPElig)&&(d=h.getProperty("nrgNotfDPPT")),("N"===a.DPPElig||"n"===a.ABPElig)&&(d=h.getProperty("nrgNotfDPPF")),b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:d,linkPress:this._openEligABPPopup.bind(this)})):b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:h.getProperty("nrgNotfDPPEmpty"),linkPress:this._reloadNotification.bind(this)}),this._eligibilityAlerts.push(b),("Y"===a.EXTNPend||"y"===a.EXTNPend)&&(b=new ute.ui.app.FooterNotificationItem({link:!1,design:"Information",text:h.getProperty("nrgNotfPE")}),this._eligibilityAlerts.push(b)),("Y"===a.CollAccActv||"y"===a.CollAccActv)&&(b=new ute.ui.app.FooterNotificationItem({link:!1,design:"Information",text:h.getProperty("nrgNotfCB")}),this._eligibilityAlerts.push(b)),("Y"===a.CSAActv||"y"===a.CSAActv)&&(b=new ute.ui.app.FooterNotificationItem({link:!1,design:"Information",text:h.getProperty("nrgNotfCSA")}),this._eligibilityAlerts.push(b)),("Y"===a.RBankDActv||"y"===a.RBankDActv)&&(b=new ute.ui.app.FooterNotificationItem({link:!1,design:"Information",text:h.getProperty("nrgNotfRBD")}),this._eligibilityAlerts.push(b)),("Y"===a.RCCardActv||"y"===a.RCCardActv)&&(b=new ute.ui.app.FooterNotificationItem({link:!1,design:"Information",text:h.getProperty("nrgNotfRCC")}),this._eligibilityAlerts.push(b)),c=0;c<this._eligibilityAlerts.length;c+=1)this._eligibilityAlerts[c].placeAt(e)}.bind(this),error:function(){var a=this.getView().byId("idnrgBilling-dpp-notifications");a&&a.getContent()&&a.getContent().length>0&&a.removeAllContent(),this._eligibilityAlerts=[],b=new ute.ui.app.FooterNotificationItem({link:!0,design:"Information",text:h.getProperty("nrgNotfReload"),linkPress:this._reloadNotification.bind(this)}),this._eligibilityAlerts.push(b),this._eligibilityAlerts[0].placeAt(a)}.bind(this)},f&&this._coNum&&f.read(e,a)},i.prototype._openEligABPPopup=function(){this.EligABPPopupCustomControl||(this.EligABPPopupCustomControl=new g({eligType:"ABP"}),this.EligABPPopupCustomControl.attachEvent("EligCompleted",function(){},this),this.getView().addDependent(this.EligABPPopupCustomControl),this.EligABPPopupCustomControl._oEligPopup.setTitle("ELIGIBILITY CRITERIA - AVERAGE BILLING PLAN")),this.EligABPPopupCustomControl.prepare()},i.prototype._openEligEXTNPopup=function(){this.EligEXTNPopupCustomControl||(this.EligEXTNPopupCustomControl=new g({eligType:"EXTN"}),this.EligEXTNPopupCustomControl.attachEvent("EligCompleted",function(){},this),this.getView().addDependent(this.EligEXTNPopupCustomControl),this.EligEXTNPopupCustomControl._oEligPopup.setTitle("ELIGIBILITY CRITERIA - EXTENSION")),this.EligEXTNPopupCustomControl.prepare()},i.prototype._openEligRBBPopup=function(){this.EligRBBPopupCustomControl||(this.EligRBBPopupCustomControl=new g({eligType:"RBB"}),this.EligRBBPopupCustomControl.attachEvent("EligCompleted",function(){},this),this.getView().addDependent(this.EligRBBPopupCustomControl),this.EligRBBPopupCustomControl._oEligPopup.setTitle("ELIGIBILITY CRITERIA - RETRO BILLING PLAN")),this.EligRBBPopupCustomControl.prepare()},i.prototype._onComAddrCheck=function(){this.getView().getModel("olocalAddress").setProperty("/current",!0),this.getView().getModel("olocalAddress").setProperty("/newAdd",!1)},i.prototype._onCurrentAddCheck=function(){this.getView().getModel("olocalAddress").setProperty("/co",this.getView().getModel("oDppStepThreeCom").getProperty("/Address/co")),this.getView().getModel("olocalAddress").setProperty("/HouseNo",this.getView().getModel("oDppStepThreeCom").getProperty("/Address/HouseNo")),this.getView().getModel("olocalAddress").setProperty("/UnitNo",this.getView().getModel("oDppStepThreeCom").getProperty("/Address/UnitNo")),this.getView().getModel("olocalAddress").setProperty("/City",this.getView().getModel("oDppStepThreeCom").getProperty("/Address/City")),this.getView().getModel("olocalAddress").setProperty("/State",this.getView().getModel("oDppStepThreeCom").getProperty("/Address/State")),this.getView().getModel("olocalAddress").setProperty("/Country",this.getView().getModel("oDppStepThreeCom").getProperty("/Address/Country")),this.getView().getModel("olocalAddress").setProperty("/AddrLine",this.getView().getModel("oDppStepThreeCom").getProperty("/Address/AddrLine")),this.getView().getModel("olocalAddress").setProperty("/Street",this.getView().getModel("oDppStepThreeCom").getProperty("/Address/Street")),this.getView().getModel("olocalAddress").setProperty("/PoBox",this.getView().getModel("oDppStepThreeCom").getProperty("/Address/PoBox")),this.getView().getModel("olocalAddress").setProperty("/ZipCode",this.getView().getModel("oDppStepThreeCom").getProperty("/Address/ZipCode")),this.getView().getModel("olocalAddress").setProperty("/NewAddrCheck",!1),this.getView().getModel("olocalAddress").setProperty("/NewAddressflag",!1),this.getView().getModel("olocalAddress").setProperty("/editable",!1)},i.prototype._onNewAddCheck=function(){this.getView().getModel("olocalAddress").setProperty("/co",""),this.getView().getModel("olocalAddress").setProperty("/HouseNo",""),this.getView().getModel("olocalAddress").setProperty("/UnitNo",""),this.getView().getModel("olocalAddress").setProperty("/City",""),this.getView().getModel("olocalAddress").setProperty("/State",""),this.getView().getModel("olocalAddress").setProperty("/Country",""),this.getView().getModel("olocalAddress").setProperty("/AddrLine",""),this.getView().getModel("olocalAddress").setProperty("/Street",""),this.getView().getModel("olocalAddress").setProperty("/PoBox",""),this.getView().getModel("olocalAddress").setProperty("/ZipCode",""),this.getView().getModel("olocalAddress").setProperty("/NewAddrCheck",!0),this.getView().getModel("olocalAddress").setProperty("/NewAddressflag",!0),this.getView().getModel("olocalAddress").setProperty("/editable",!0)},i.prototype._postDPPCommunication=function(){var a=this.getView().getModel("oDppStepThreeCom"),b=a.oData,c=this.getView().getModel("olocalAddress");if(b.eMailCheck&&!b.eMail)return ute.ui.main.Popup.Alert({title:"DPP",message:"Email field is empty"}),!0;if(b.FaxCheck){if(!b.Fax)return ute.ui.main.Popup.Alert({title:"DPP",message:"Please enter Fax Number"}),!0;if(!b.FaxTo)return ute.ui.main.Popup.Alert({title:"DPP",message:"Please enter Fax To"}),!0}if(b.AddrCheck&&c.getProperty("/newAdd")){if(!(c.getProperty("/HouseNo")&&c.getProperty("/Street")||c.getProperty("/PoBox")))return ute.ui.main.Popup.Alert({title:"DPP",message:"Please enter street no & street name or PO Box"}),!0;if(!c.getProperty("/City"))return ute.ui.main.Popup.Alert({title:"DPP",message:"Please enter city"}),!0;if(!c.getProperty("/State"))return ute.ui.main.Popup.Alert({title:"DPP",message:"Please enter state"}),!0;if(!c.getProperty("/ZipCode"))return ute.ui.main.Popup.Alert({title:"DPP",message:"Please enter zip Code"}),!0;if(!c.getProperty("/Country"))return ute.ui.main.Popup.Alert({title:"DPP",message:"Please enter country"}),!0}return this._sendDppComunication(),!0},i.prototype._TrilliumAddressCheck=function(){var a,b,c=this.getView().getModel("olocalAddress"),d=this.getOwnerComponent().getModel("comp-bupa"),e=this._createAddrValidateFilters(),f=this.getView().getModel("oDtaAddrEdit");c.setProperty("/updateSent",!0),c.setProperty("/showVldBtns",!0),c.setProperty("/updateNotSent",!1),a="/BuagAddrDetails",b={filters:e,success:function(a){"X"===a.results[0].AddrChkValid?(this._oMailEditPopup.close(),this._updateMailingAddr()):(f.setProperty("/SuggAddrInfo",a.results[0].TriCheck),this._showSuggestedAddr())}.bind(this),error:function(){sap.ui.commons.MessageBox.alert("Validatation Call Failed")}.bind(this)},d&&d.read(a,b)},i.prototype._createAddrValidateFilters=function(){var a,b,c,d=[],g=this.getView().getModel("oDataBuagAddrDetails").getProperty("/PartnerID"),h=this.getView().getModel("oDtaAddrEdit"),i=h.getProperty("/AddrInfo"),j=h.getProperty("/bFixAddr");j?(a=new e({path:"FixUpd",operator:f.EQ,value1:"X"}),d.push(a)):(a=new e({path:"TempUpd",operator:f.EQ,value1:"X"}),d.push(a)),a=new e({path:"PartnerID",operator:f.EQ,value1:g}),d.push(a),a=new e({path:"ChkAddr",operator:f.EQ,value1:"X"}),d.push(a);for(b in i)i.hasOwnProperty(b)&&"__metadata"!==b&&"StandardFlag"!==b&&"ShortForm"!==b&&"ValidFrom"!==b&&"ValidTo"!==b&&"Supplement"!==b&&(j?(c="FixAddrInfo/"+b,a=new e({path:c,operator:f.EQ,value1:i[b]}),d.push(a)):(c="TempAddrInfo/"+b,a=new e({path:c,operator:f.EQ,value1:i[b]
}),d.push(a)));return d},i.prototype._sendDppComunication=function(){var a,b,c,d=this.getView().getModel("oDataSvc"),e=this.getView().getModel("oDppStepThreeCom"),f=e.oData,g=this.getView().getModel("olocalAddress"),i=this;b="/DPPCorresps",c=function(){var a=new h;i.getView().addDependent(a),a.openQuickPay(i._coNum,i._bpNum,i._caNum),a.attachEvent("PaymentCompleted",function(){i._onCheckbook()},this)},a={merge:!1,success:function(a){ute.ui.main.Popup.Alert(a.Error?a.Message?{title:"DPP",message:a.Message,callback:c}:{title:"DPP",message:"Correspondence Failed",callback:c}:{title:"DPP",message:"Correspondence Successfully Sent.",callback:c})}.bind(this),error:function(){ute.ui.main.Popup.Alert({title:"DPP",message:"Correspondence Failed"})}.bind(this)},d&&(e.oData.Process="DPP",g.getProperty("/newAdd")&&(f.Address.co=g.getProperty("/co"),f.Address.HouseNo=g.getProperty("/HouseNo"),f.Address.UnitNo=g.getProperty("/UnitNo"),f.Address.City=g.getProperty("/City"),f.Address.State=g.getProperty("/State"),f.Address.Country=g.getProperty("/Country"),f.Address.AddrLine=g.getProperty("/AddrLine"),f.Address.Street=g.getProperty("/Street"),f.Address.PoBox=g.getProperty("/PoBox"),f.Address.ZipCode=g.getProperty("/ZipCode"),f.NewAddr=g.getProperty("/NewAddrCheck")),d.create(b,e.oData,a))},i.prototype._retrDppComunication=function(){var a,b,c=this.getView().getModel("oDataSvc"),d="DPP",e=this.getView().getModel("olocalAddress");b="/DPPCorresps(CA='"+this._caNum+"',Contract='"+this._coNum+"',BP='"+this._bpNum+"',Process='"+d+"')",a={success:function(a){a&&(this.getView().getModel("oDppStepThreeCom").setData(a),a.AddrCheck&&(e.setProperty("/current",!0),e.setProperty("/newAdd",!1)),a.Address&&(e.setProperty("/co",a.Address.co),e.setProperty("/HouseNo",a.Address.HouseNo),e.setProperty("/UnitNo",a.Address.UnitNo),e.setProperty("/City",a.Address.City),e.setProperty("/State",a.Address.State),e.setProperty("/Country",a.Address.Country),e.setProperty("/AddrLine",a.Address.AddrLine),e.setProperty("/Street",a.Address.Street),e.setProperty("/PoBox",a.Address.PoBox),e.setProperty("/ZipCode",a.Address.ZipCode)))}.bind(this),error:function(){}.bind(this)},c&&c.read(b,a)},i.prototype._formatInstalments=function(a,b){return a?b?parseInt(a,10)-1:a:""},i});