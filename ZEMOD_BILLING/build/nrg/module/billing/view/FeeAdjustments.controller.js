sap.ui.define(["nrg/base/view/BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","jquery.sap.global","sap/ui/model/json/JSONModel","nrg/base/type/Price"],function(a,b,c,d,e){"use strict";var f=a.extend("nrg.module.billing.view.FeeAdjustments");return f.prototype.onBeforeRendering=function(){{var a,b,c,d,f,g,h=new e({discNoticefee:!1,discRecovfee:!0,Latefee:!0,Reconnectfee:!0,feeDateDD:!0,reasonDD:!1,ok:!1,feeSelected:!1,textArea:""}),i=this.getOwnerComponent().getCcuxRouteManager().getCurrentRouteInfo(),j=this.getView().byId("idnrgFeeAdj-DropDownCA"),k=this.getView().byId("idnrgFeeAdj-DropDownCA-temp"),l=this.getView().byId("idnrgFeeAdj-DropDownDate"),m=this.getView().byId("idnrgFeeAdj-DropDownDate-temp").clone(),n=this;this.getView().byId("idnrgFeeAdj-textArea")}l.removeAllContent(),this._sContract=i.parameters.coNum,this._sBP=i.parameters.bpNum,this._sCA=i.parameters.caNum,this._sCO=i.parameters.coNum,this.getView().setModel(h,"view-feeAdj"),a=["BP"],b=[this._sBP],c=this._createSearchFilterObject(a,b),d="/ContractAcctS",g=function(){var e,g=j.getContent();g&&g.length>0&&(n._sCA=parseInt(n._sCA,10),j.setSelectedKey(n._sCA),a=["CA"],b=[n._sCA],c=n._createSearchFilterObject(a,b),d="/DiscNoticeFeeS",e=function(){l.getContent()&&0===l.getContent().length?l.setPlaceholder("No Fee(s) Found"):l.getContent()&&l.getContent().length>0&&l.setPlaceholder("CHOOSE THE FEE")},f={model:"comp-feeAdjs",path:d,template:m,filters:c,events:{dataReceived:e}},l.bindAggregation("content",f))},f={model:"comp-feeAdjs",path:d,template:k,filters:c,events:{dataReceived:g}},j.bindAggregation("content",f)},f.prototype._createSearchFilterObject=function(a,d){var e,f=[];for(e=0;e<a.length;e+=1)f.push(new b(a[e],c.EQ,d[e],""));return f},f.prototype.onSubmit=function(){var a,b,c,d,e=this.getOwnerComponent().getModel("comp-feeAdjs"),f=this.getView().byId("idnrgFeeAdj-DropDownCA"),g=this.getView().byId("idnrgFeeAdj-textArea"),h=this.getView().byId("idnrgFeeAdj-DropDownDate"),i=this.getView().byId("idnrgFeeAdj-DropDownReason"),j=this.getView().getModel("view-feeAdj"),k=this;return this.getOwnerComponent().getCcuxApp().setOccupied(!0),j.getProperty("/discNoticefee")||(d="/DiscNoticeFeeS",c="DISC_NOTIC"),j.getProperty("/discRecovfee")||(d="/DiscRecovFeeS",c="DISC_RECVR"),j.getProperty("/Latefee")||(d="/LateFeeS",c=i.getSelectedKey())?(j.getProperty("/Reconnectfee")||(d="/ReconReqFeeS",c="RECON_REQ"),d=d+"(CA='"+f.getSelectedKey()+"',DocNum='"+h.getSelectedKey()+"')/Amount",b=e.getProperty(d),a={method:"POST",urlParameters:{Amount:b||0,CA:f.getSelectedKey(),DocNum:h.getSelectedKey(),Reason:c,Text:g.getValue()},success:function(a){if(k.getOwnerComponent().getCcuxApp().setOccupied(!1),a&&a.Success)ute.ui.main.Popup.Alert({title:"Fee Adjustments",message:a.Message});else{var b="<div style='margin:10px'>"+a.Message+"</div>",c=new sap.ui.core.HTML({content:b}),d=new ute.ui.main.Button({text:"OK",press:function(){k._AlertDialog.close()}}),e=new ute.ui.commons.Tag;e.addContent(c),e.addContent(d),void 0===k._AlertDialog&&(k._AlertDialog=new ute.ui.main.Popup.create({title:"Fee Adjustments",content:e})),k._AlertDialog.open()}k.navTo("billing.CheckBook",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sCO})}.bind(this),error:function(){k.getOwnerComponent().getCcuxApp().setOccupied(!1),ute.ui.main.Popup.Alert({title:"Fee Adjustments",message:"Late Fee has not been removed."}),k.navTo("billing.CheckBook",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sCO})}.bind(this)},void e.callFunction("/RemoveFee",a)):(this.getOwnerComponent().getCcuxApp().setOccupied(!1),void ute.ui.main.Popup.Alert({title:"Information",message:"Please select a Reason"}))},f.prototype.onDiscNoticeFee=function(){var a,b,c,d,e,f,g=this.getView().getModel("view-feeAdj"),h=this.getView().byId("idnrgFeeAdj-DropDownDate"),i=this.getView().byId("idnrgFeeAdj-DropDownDate-temp").clone(),j=this.getView().byId("idnrgFeeAdj-DropDownCA"),k=this.getView().byId("idnrgFeeAdj-textArea");k.setValue(""),h.removeAllContent(),g.setProperty("/discNoticefee",!1),g.setProperty("/discRecovfee",!0),g.setProperty("/Latefee",!0),g.setProperty("/Reconnectfee",!0),g.setProperty("/reasonDD",!1),g.setProperty("/textArea",""),a=["CA"],b=[j.getSelectedKey()],c=this._createSearchFilterObject(a,b),d="/DiscNoticeFeeS",f=function(){h.getContent()&&0===h.getContent().length?h.setPlaceholder("No Fee(s) Found"):h.getContent()&&h.getContent().length>0&&h.setPlaceholder("CHOOSE THE FEE")},e={model:"comp-feeAdjs",path:d,template:i,filters:c,events:{dataReceived:f}},h.bindAggregation("content",e)},f.prototype.onDiscRecovFee=function(){var a,b,c,d,e,f,g=this.getView().getModel("view-feeAdj"),h=this.getView().byId("idnrgFeeAdj-DropDownDate"),i=this.getView().byId("idnrgFeeAdj-DropDownDate-temp").clone(),j=this.getView().byId("idnrgFeeAdj-DropDownCA"),k=this.getView().byId("idnrgFeeAdj-textArea");k.setValue(""),h.removeAllContent(),g.setProperty("/discNoticefee",!0),g.setProperty("/discRecovfee",!1),g.setProperty("/Latefee",!0),g.setProperty("/Reconnectfee",!0),g.setProperty("/reasonDD",!1),g.setProperty("/textArea",""),a=["CA"],b=[j.getSelectedKey()],c=this._createSearchFilterObject(a,b),d="/DiscRecovFeeS",f=function(){h.getContent()&&0===h.getContent().length?h.setPlaceholder("No Fee(s) Found"):h.getContent()&&h.getContent().length>0&&h.setPlaceholder("CHOOSE THE FEE")},e={model:"comp-feeAdjs",path:d,template:i,filters:c,events:{dataReceived:f}},h.bindAggregation("content",e)},f.prototype.onLateFee=function(){var a,b,c,d,e,f,g,h=this.getView().getModel("view-feeAdj"),i=this.getView().byId("idnrgFeeAdj-DropDownDate"),j=this.getView().byId("idnrgFeeAdj-DropDownDate-temp").clone(),k=this.getView().byId("idnrgFeeAdj-DropDownCA"),l=this.getView().byId("idnrgFeeAdj-DropDownReason"),m=this.getView().byId("idnrgFeeAdj-DropDownReason-temp").clone(),n=this.getView().byId("idnrgFeeAdj-textArea");n.setValue(""),i.removeAllContent(),l.removeAllContent(),h.setProperty("/discNoticefee",!0),h.setProperty("/discRecovfee",!0),h.setProperty("/Latefee",!1),h.setProperty("/Reconnectfee",!0),h.setProperty("/reasonDD",!0),h.setProperty("/textArea",""),a=["CA"],b=[k.getSelectedKey()],c=this._createSearchFilterObject(a,b),d="/LateFeeS",f=function(){i.getContent()&&0===i.getContent().length?i.setPlaceholder("No Fee(s) Found"):i.getContent()&&i.getContent().length>0&&i.setPlaceholder("CHOOSE THE FEE")},e={model:"comp-feeAdjs",path:d,template:j,filters:c,events:{dataReceived:f}},i.bindAggregation("content",e),g=function(){l.getContent()&&0===l.getContent().length?l.setPlaceholder("No Reason(s) Found"):l.getContent()&&l.getContent().length>0&&l.setPlaceholder("CHOOSE THE REASON")},d="/RemovalReasonS",e={model:"comp-feeAdjs",path:d,template:m,events:{dataReceived:g}},l.bindAggregation("content",e)},f.prototype.onReconnectFee=function(){var a,b,c,d,e=this.getView().getModel("view-feeAdj"),f=this.getView().byId("idnrgFeeAdj-DropDownDate"),g=this.getView().byId("idnrgFeeAdj-DropDownDate-temp").clone(),h=(this.getView().byId("idnrgFeeAdj-DropDownCA"),this.getView().byId("idnrgFeeAdj-textArea"));h.setValue(""),f.removeAllContent(),e.setProperty("/discNoticefee",!0),e.setProperty("/discRecovfee",!0),e.setProperty("/Latefee",!0),e.setProperty("/Reconnectfee",!1),e.setProperty("/reasonDD",!1),e.setProperty("/textArea",""),b="/ReconReqFeeS",d=function(){f.getContent()&&0===f.getContent().length?f.setPlaceholder("No Fee(s) Found"):f.getContent()&&f.getContent().length>0&&f.setPlaceholder("CHOOSE THE FEE")},c={model:"comp-feeAdjs",path:b,template:g,filters:a,events:{dataReceived:d}},f.bindAggregation("content",c)},f.prototype._onCoSelect=function(){var a=this.getView().getModel("view-feeAdj");a.getProperty("/discNoticefee")||this.onDiscNoticeFee(),a.getProperty("/discRecovfee")||this.onDiscRecovFee(),a.getProperty("/Latefee")||this.onLateFee(),a.getProperty("/Reconnectfee")||this.onReconnectFee()},f.prototype._parseCAValue=function(a){return a?parseInt(a,10):""},f.prototype._onFeeDDSelect=function(){var a=this.getView().getModel("view-feeAdj");a.setProperty("/ok",!0)},f.prototype.onCancel=function(){var a=this.getOwnerComponent().getGlobalDataManager();a.isPrepay()?this._sCO?this.navTo("billing.PrePayCheckBook",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sCO}):this.navTo("billing.PrePayCheckBookNoCo",{bpNum:this._sBP,caNum:this._sCA}):this.navTo("billing.CheckBook",{bpNum:this._sBP,caNum:this._sCA,coNum:this._sCO})},f.prototype.Popupclose=function(){this._AlertDialog.close()},f});