sap.ui.define(["sap/ui/core/Control","jquery.sap.global","sap/ui/thirdparty/d3"],function(a,b){"use strict";var c=a.extend("nrg.module.billing.view.control.AverageBillDetailsChart",{metadata:{properties:{width:{type:"int",defaultValue:900},height:{type:"int",defaultValue:400},usageTickSize:{type:"int",defaultValue:500}}},renderer:function(a,b){a.write("<div"),a.writeControlData(b),a.addClass("nrgAVDChart"),a.writeClasses(),a.write(">"),a.write("</div>")}});return c.prototype.onExit=function(){this._oDataModel=null,this._oCanvas=null},c.prototype.onAfterRendering=function(){this._createChart()},c.prototype.hideUsage=function(a,b){return this._oCanvas&&this._oCanvas.selectAll(".nrgAVDChart-usage").each(function(c){c.key===a&&(b?d3.select(this).style("display","none"):d3.select(this).style("display",null))}),this},c.prototype.refreshChart=function(){this.rerender()},c.prototype.setDataModel=function(a,b){return this._oDataModel=a,b&&b(),this},c.prototype.getDataModel=function(){return this._oDataModel},c.prototype._getDataSet=function(){var a=b.extend(!0,[],this.getDataModel().getData().data),c=d3.time.format("%x").parse;return a.forEach(function(a){a.usageDate=c(a.usageDate)},this),a},c.prototype._createChart=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=this,p={top:10,right:30,bottom:40,left:80},q=o.getWidth()-p.left-p.right,r=o.getHeight()-p.top-p.bottom,s=o._getDataSet(),t=d3.extent(s,function(a){return a.usageDate.getMonth()});a=d3.scale.linear().domain(t).range([0,q]),b=o.getUsageTickSize(),c=d3.max(s,function(a){return a.usage}),d=c+(b-c%b),e=d3.min(s,function(a){return a.usage}),f=e-e%b-b,f=0>f?0:f,g=d3.scale.linear().domain([f,d]).range([r,0]),this._oCanvas=d3.select("#"+this.getId()).append("svg").attr("class","nrgAVDChart").attr("width",o.getWidth()).attr("height",o.getHeight()).attr("viewBox",[0,0,q+p.left+p.right,r+p.top+p.bottom].join(" ")).append("g").attr("transform","translate("+[p.left,p.top]+")"),h=d3.scale.ordinal().domain(d3.range(12)).range(["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"]),i=d3.svg.axis().scale(a).orient("bottom").tickValues(d3.range(t[0],t[1]+1)).tickFormat(function(a){return h(a)}),this._oCanvas.append("g").attr("class","nrgAVDChart-XAxis").attr("transform","translate("+[0,r+20]+")").call(i),j=d3.svg.axis().scale(g).orient("left").ticks(Math.floor((c-e)/b)+1).tickFormat(d3.format(",")),this._oCanvas.append("g").attr("class","nrgAVDChart-YAxis").attr("transform","translate("+[-30,0]+")").call(j),this._oCanvas.append("g").selectAll("line").data(d3.range(t[0],t[1]+1)).enter().append("line").attr("class","nrgAVDChart-XGrid").attr("x1",function(b){return a(b)}).attr("y1",0).attr("x2",function(b){return a(b)}).attr("y2",r),this._oCanvas.append("g").selectAll("line").data(d3.range(f,d,b)).enter().append("line").attr("class","nrgAVDChart-YGrid").attr("x1",0).attr("y1",function(a){return g(a)}).attr("x2",q+30).attr("y2",function(a){return g(a)}),k=d3.nest().key(function(a){return a.usageDate.getFullYear()}).entries(s),l=d3.scale.ordinal().domain(k,function(a){return a.key}).range(["#ffffff","#5092CE","#545A6A","#F2A814"]),m=d3.svg.line().x(function(b){return a(b.usageDate.getMonth())}).y(function(a){return g(a.usage)}),n=this._oCanvas.append("g").selectAll("g").data(k).enter().append("g").attr("class","nrgAVDChart-usage"),n.append("path").attr("class","nrgAVDChart-usageLine").attr("d",function(a){return m(a.values)}).style("stroke",function(a){return l(a.key)}).style("fill","none"),n.selectAll("g").data(function(a){return a.values}).enter().append("circle").attr("class","nrgAVDChart-usageDataPoint").attr("r","4").attr("cx",function(b){return a(b.usageDate.getMonth())}).attr("cy",function(a){return g(a.usage)}).style("stroke",function(a){return l(a.usageDate.getFullYear())}).style("stroke-opacity",.3).style("fill",function(a){return l(a.usageDate.getFullYear())})},c});